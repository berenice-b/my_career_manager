<% @next_steps = @application.steps.to_a.select {|x| x.status == false}.sort_by &:date %>
<% @steps_done= @application.steps.to_a.select {|x| x.status == true}.sort_by &:date %>


<div id="task-list-one">

  <!-- Task Item -->
  <% @next_steps.each do |next_step| %>


  <div class="card mb-0" id="card-step-<%=next_step.id%>">
    <div class="card-body p-3">
      <div class="row">
        <div class="col">
          <div class="row justify-content-center">
            <span class="badge step-category-show <%= 'badge-success' if next_step.category == 'interview' %><%= 'badge-warning' if next_step.category == 'phone interview' %><%= 'badge-danger' if next_step.category == 'follow-up' %>">
              <%= next_step.category %>
            </span>
            <small class=" badge step-date-show d-flex align-items-center <%= 'badge-success-lighten' if next_step.category == 'interview' %><%= 'badge-warning-lighten' if next_step.category == 'phone interview' %><%= 'badge-danger-lighten' if next_step.category == 'follow-up' %>">
              <% unless next_step.date == nil %>
              <%= next_step.date.strftime '%a %m/%d' %>
              <% end %>
            </small>
          </div>
          <!--end of row -->

          <% unless next_step.title === "" && next_step.description === ""  %>
          <div class="row">

            <div class="col step-col-show">

              <% unless next_step.title === "" %>
              <strong>
                <%= next_step.title %> </strong> <br>
              <% end %>

              <% unless next_step.description === "" %>
              <%= next_step.description %>
              <% end %>

            </div> <!-- end of col -->
          </div> <!-- end of row -->
          <% end %>
        </div> <!-- end of col -->

        <div class="col-3 d-flex align-items-center justify-content-around">
          <i class="fas fa-edit" data-toggle="modal" data-target="#update-next_step-modal-<%= next_step.id %>"></i>
          <%= check_box_tag "checkbox-step-#{next_step.id}" , 'status', false , data: {remote: true, url: validate_application_step_path(@application, next_step), method: :patch, :confirm => 'This will validate your step and move it to the card "Notes". Are you sure you want to proceed ?'}, class:"checkbox-step" %>
        </div>
      </div>
      <!-- end main-row -->

    </div>
    <!-- end card-body -->
  </div>
  <!-- end card -->


  <!---------------------------------- MODAL UPDATE NEXT STEP----------------------------------->


  <div id="update-next_step-modal-<%= next_step.id %>" class="modal fade" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-body">
          <div class="text-center mt-2 mb-4">
            <h3> Update this step</h3>
            <i class="fas fa-stopwatch"></i>
          </div>

          <%= form_tag(application_step_path(@application, next_step), method: "put", class: 'pl-3 pr-3') do %>

          <div class="form-group">
            <%= label_tag 'Date *' %><br />
            <%= date_field_tag :date, next_step.date, class: 'form-control' %>
          </div>

          <div class="form-group">
            <%= label_tag(:category, "Category") %>
            <%= select_tag "category", "<option>interview</option><option>phone interview</option><option>follow-up</option><option>application sent</option>".html_safe, class: 'custom-select' %>
          </div>


          <div class="form-group">
            <%= label_tag(:title, "Title") %>
            <%= text_field_tag :title, next_step.title, class: 'form-control', placeholder: 'Enter the title' %>
          </div>

          <div class="form-group">
            <%= label_tag 'Description' %><br />
            <%= text_area_tag :description, next_step.description, class: 'form-control', placeholder: 'Describe the step here' %>
          </div>

          <div class="form-group text-center">

            <%= submit_tag "Update", class: "btn btn-primary", style:"margin-right:20px" %>
            <%= link_to application_step_path(@application, next_step), method: :delete do %>

            <button type="button" class="btn btn-danger" style="margin-left: 20px;">Delete</button>
            <% end %>



          </div>

          <% end %>
        </div>
      </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
  </div><!-- /.modal -->


  <!------------------------------------------------------------------------------------------------------------>
  <% end %>

  <!-------------- Start Card 'steps done' ---------------------->

  <div class="card mb-0" id="past_steps_card" %>
    <% unless @steps_done.count == 0 %>
    <div class="card-body p-3">

      <h5>STEPS DONE</h5>
      <% @steps_done.each do |step| %>
      <a>
        <%= step.category%> -
        <%= step.date%> </a> <br>
      <% end %>

    </div>
    <% end %>
  </div>

  <!-------------- End Card 'steps done' ---------------------->




  <!-- Task Item End -->

  <div class="container text-center">
      
    <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#new-step-modal">Add step</button>
    
  </div>
</div>